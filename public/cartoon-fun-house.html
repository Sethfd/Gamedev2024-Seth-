<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doom-like 3D FPS with Flashlight and Gun</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const context = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Game variables
        const player = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            angle: Math.PI / 2,
            speed: 2,
            rotationSpeed: 0.05,
            width: 64,
            height: 64,
            texture: new Image() // Player texture
        };
        player.texture.src = 'path/to/your/player-image.png'; // Use actual path to your player PNG

        const map = [
            '1111111111111111',
            '1000000000000011',
            '1011111111111011',
            '1010000000011011',
            '1011111111011011',
            '1010000000011011',
            '1001111111011011',
            '1111111111111111'
        ];

        const FOV = Math.PI / 3; // Field of view
        const MAX_DEPTH = 10; // Maximum raycast depth

        // Key and Door logic
        let keys = [];
        let collectedKeys = 0;
        let door = {
            x: 0,
            y: 0,
            width: 50,
            height: 100,
            isOpen: false,
            texture: new Image(), // Door texture (closed)
            openTexture: new Image() // Open door texture
        };

        // Normal door texture (closed door)
        door.texture.src = 'https://github.com/Sethfd/Gamedev2024-Seth-/blob/main/PNG,S/pixil-frame-0%20(70).png?raw=true'; 

        // Open door texture (when the door is unlocked)
        door.openTexture.src = 'https://github.com/Sethfd/Gamedev2024-Seth-/blob/main/PNG,S/pixil-frame-0%20(73).png?raw=true'; 

        // Key Texture (from your provided URL)
        const keyTexture = new Image();
        keyTexture.src = 'https://github.com/Sethfd/Gamedev2024-Seth-/blob/main/PNG,S/pixil-frame-0%20(72).png?raw=true'; // Direct GitHub URL for your key PNG

        // Wall Texture (from your provided URL)
        const wallTexture = new Image();
        wallTexture.src = 'https://github.com/Sethfd/Gamedev2024-Seth-/blob/main/PNG,S/pixil-frame-0%20(69).png?raw=true'; // Wall texture URL

        // Floor Texture (same URL as wall texture)
        const floorTexture = new Image();
        floorTexture.src = 'https://github.com/Sethfd/Gamedev2024-Seth-/blob/main/PNG,S/pixil-frame-0%20(69).png?raw=true'; // Use same texture for the floor

        // Flashlight Texture (from the provided URL)
        const flashlightTexture = new Image();
        flashlightTexture.src = 'https://github.com/Sethfd/Gamedev2024-Seth-/blob/main/PNG,S/pixil-frame-0%20(74).png?raw=true'; // Path to your flashlight PNG

        // Gun Texture (from the provided URL)
        const gunTexture = new Image();
        gunTexture.src = 'https://github.com/Sethfd/Gamedev2024-Seth-/blob/main/PNG,S/pixil-frame-0%20(68).png?raw=true'; // Path to your gun PNG

        // Enemy logic
        let enemies = [];
        let stunnedEnemies = [];

        // Flashlight mechanics
        let flashlightCooldown = 20000; // Cooldown time 20 seconds
        let flashlightChargeTime = 3000; // Charge-up time 3 seconds
        let flashlightStunTime = 15000; // Flashlight stun duration 15 seconds
        let flashlightActive = false; // Whether flashlight is active or not
        let flashlightReady = true; // Whether flashlight is ready to use (no cooldown)
        let flashlightChargeStart = 0; // Time when flashlight charge starts
        let flashlightStunStart = 0; // Time when flashlight stun started

        // Key and Door logic
        let keys = [];
        let collectedKeys = 0;
        let door = {
            x: 0,
            y: 0,
            width: 50,
            height: 100,
            isOpen: false,
            texture: new Image(), // Door texture (closed)
            openTexture: new Image() // Open door texture
        };

        // Normal door texture (closed door)
        door.texture.src = 'https://github.com/Sethfd/Gamedev2024-Seth-/blob/main/PNG,S/pixil-frame-0%20(70).png?raw=true'; 

        // Open door texture (when the door is unlocked)
        door.openTexture.src = 'https://github.com/Sethfd/Gamedev2024-Seth-/blob/main/PNG,S/pixil-frame-0%20(73).png?raw=true'; 

        // Random key and door placement
        function placeKeysAndDoor() {
            keys = [];
            for (let i = 0; i < 5; i++) {
                let key = {
                    x: Math.floor(Math.random() * canvas.width),
                    y: Math.floor(Math.random() * canvas.height),
                    width: 20,
                    height: 20,
                    texture: keyTexture
                };
                keys.push(key);
            }

            door.x = Math.floor(Math.random() * canvas.width);
            door.y = Math.floor(Math.random() * canvas.height);
            door.isOpen = false;
        }

        // Handle flashlight charge-up, activation, and cooldown
        function handleFlashlight() {
            if (!flashlightReady && Date.now() - flashlightChargeStart > flashlightChargeTime) {
                flashlightReady = true;
                console.log("Flashlight ready!");
            }

            if (flashlightActive && Date.now() - flashlightStunStart > flashlightStunTime) {
                flashlightActive = false;
                stunnedEnemies = [];
                console.log("Flashlight stun ended.");
            }

            if (flashlightReady && keysInput['f']) {
                flashlightChargeStart = Date.now();
                flashlightReady = false;
                flashlightActive = true;
                flashlightStunStart = Date.now();
                console.log("Flashlight activated!");
            }

            if (flashlightActive) {
                context.fillStyle = "rgba(255, 255, 255, 0.5)";
                context.fillRect(0, 0, canvas.width, canvas.height);
            }
        }

        // Stun enemies using flashlight
        function stunEnemies() {
            enemies.forEach((enemy) => {
                if (flashlightActive && !stunnedEnemies.includes(enemy)) {
                    stunnedEnemies.push(enemy);
                    setTimeout(() => {
                        const index = stunnedEnemies.indexOf(enemy);
                        if (index > -1) stunnedEnemies.splice(index, 1);
                    }, flashlightStunTime);
                }
            });
        }

        // Enemy AI (basic)
        function spawnEnemy() {
            let enemy = {
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                width: 30,
                height: 30,
                speed: 1,
                isStunned: false
            };
            enemies.push(enemy);
        }

        // Update enemies based on stun status
        function updateEnemies() {
            enemies.forEach(enemy => {
                if (!stunnedEnemies.includes(enemy)) {
                    // Move normally if not stunned
                    enemy.x += Math.cos(Math.random() * Math.PI * 2) * enemy.speed;
                    enemy.y += Math.sin(Math.random() * Math.PI * 2) * enemy.speed;
                }
            });
        }

        // Raycasting function
        function castRay(angle) {
            let x = player.x;
            let y = player.y;
            let sin = Math.sin(angle);
            let cos = Math.cos(angle);
            for (let depth = 0; depth < MAX_DEPTH; depth++) {
                x += cos;
                y += sin;
                // Check collision with walls in the map
                if (map[Math.floor(y / 64)] && map[Math.floor(y / 64)][Math.floor(x / 64)] === '1') {
                    return depth;
                }
            }
            return MAX_DEPTH;
        }

        // Draw the game world
        function drawWorld() {
            for (let i = 0; i < canvas.width; i++) {
                let angle = player.angle - FOV / 2 + (i / canvas.width) * FOV;
                let depth = castRay(angle);
                let wallHeight = canvas.height / depth;
                context.fillStyle = 'gray';
                context.fillRect(i, canvas.height / 2 - wallHeight / 2, 1, wallHeight);
            }
        }

        // Draw keys, player, and door
        function drawEntities() {
            context.drawImage(player.texture, player.x, player.y, player.width, player.height);
            keys.forEach(key => context.drawImage(key.texture, key.x, key.y, key.width, key.height));
            if (door.isOpen) {
                context.drawImage(door.openTexture, door.x, door.y, door.width, door.height);
            } else {
                context.drawImage(door.texture, door.x, door.y, door.width, door.height);
            }
        }

        // Game loop
        function gameLoop() {
            context.clearRect(0, 0, canvas.width, canvas.height);
            drawWorld();
            handleFlashlight();
            updateEnemies();
            drawEntities();
            stunEnemies();
            requestAnimationFrame(gameLoop);
        }

        placeKeysAndDoor();
        gameLoop();

    </script>
</body>
</html>
