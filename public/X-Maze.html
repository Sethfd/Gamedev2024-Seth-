<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dungeon Crawler</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #282c34;
            color: white;
            padding: 20px;
        }
        .button {
            margin: 5px;
            padding: 10px;
            background-color: #61dafb;
            border: none;
            cursor: pointer;
        }
        #output {
            margin-top: 20px;
        }
        #inventory {
            margin-top: 20px;
        }
        .health-bar {
            width: 100%;
            background-color: #555;
            border-radius: 5px;
            margin: 5px 0;
        }
        .health {
            height: 20px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Dungeon Crawler</h1>
    <div id="output"></div>
    <div class="health-bar">
        <div id="playerHealthBar" class="health" style="width: 100%; background-color: green;"></div>
    </div>
    <div class="health-bar">
        <div id="monsterHealthBar" class="health" style="width: 0%; background-color: red;"></div>
    </div>
    <div>
        <button class="button" id="moveBtn">Move</button>
        <button class="button" id="fightBtn">Fight</button>
        <button class="button" id="dodgeBtn">Dodge</button>
        <button class="button" id="searchBtn">Search</button>
        <button class="button" id="inventoryBtn">View Inventory</button>
        <button class="button" id="useItemBtn">Use Item</button>
    </div>
    <div id="inventory"></div>

    <script>
        const rooms = {
            0: { description: "You are in the Entrance. A dark hallway stretches ahead.", exits: [1, 2] },
            1: { description: "You are in the Hallway. Dimly lit torches flicker on the walls, casting eerie shadows. You can hear faint whispers echoing in the distance.", exits: [0, 3, 4] },
            2: { description: "You are in the Treasure Room. It's filled with gold! A glimmer catches your eye.", exits: [1] },
            3: { 
                description: "You are in a Monster Room! Prepare to fight! There's an ominous shadow in the corner, perhaps a secret door.", 
                exits: [1, 5], 
                interaction: "Do you want to investigate the shadow? (yes/no)" 
            },
            4: { description: "You are in a Hidden Room. An ancient tome rests on a pedestal, its pages fluttering as if alive.", exits: [1, 6] },
            5: { description: "You enter a dusty storage room. It's dark and filled with cobwebs.", exits: [3, 7], interaction: "You notice a loose floorboard. Do you want to check it? (yes/no)" },
            6: { description: "You are in a library filled with ancient books. One book seems to glow faintly.", exits: [4, 8], interaction: "Do you wish to pull the glowing book? (yes/no)" },
            7: { description: "This room is filled with old weapons and armor. A knightâ€™s statue looms in the corner, clutching a shield.", exits: [5] },
            8: { description: "You discover a small chapel. The walls are adorned with faded frescoes depicting ancient battles. A faint voice whispers to you, urging you to listen closely.", exits: [6, 9] },
            24: { description: "You enter a grand chamber filled with darkness. In the center, a formidable figure awaits: the Dark Overlord!", exits: [] },
        };

        const searchResponses = {
            0: { item: "dusty old map", message: "You find a dusty old map of the dungeon in the Entrance." },
            1: { item: "footprints", message: "You discover some footprints leading further into the Hallway." },
            2: { item: "ancient coins", message: "You find a hidden compartment filled with ancient coins!" },
            3: { item: "trapdoor", message: "You spot a hidden trapdoor in the Monster Room." },
            4: { item: "strange tome", message: "You find an old tome with strange symbols in the Hidden Room." },
            5: { item: "rusty sword", message: "You uncover a rusty sword buried under the dust in the storage room." },
        };

        const enemies = [
            { name: "Goblin", health: 25, minDamage: 5, maxDamage: 10 },
            { name: "Skeleton", health: 30, minDamage: 3, maxDamage: 8 },
            { name: "Zombie", health: 40, minDamage: 2, maxDamage: 5 },
            { name: "Orc", health: 50, minDamage: 6, maxDamage: 12 },
            { name: "Dragon", health: 70, minDamage: 8, maxDamage: 15 }
        ];

        let currentRoom = 0;
        let playerHealth = 100;
        let monsterHealth = 0;
        let monsterName = "";
        let inCombat = false;
        let inventory = [];
        let keyFound = false; // Track if the key is found
        const usableItems = {
            "rusty sword": { type: "damage", value: 10 },
            "fireproof amulet": { type: "defense", value: 5 },
            "bubbling potion": { type: "heal", value: 20 },
            "small key": { type: "unlock", value: null },
            "mystical shield": { type: "defense", value: 15 },
            "magic orb": { type: "damage", value: 15 },
            "ancient scroll": { type: "heal", value: 30 },
            "hidden spell": { type: "damage", value: 20 } // New spell item
        };

        let visitedRooms = new Set(); // Track visited rooms

        function updateOutput(message) {
            const output = document.getElementById('output');
            output.innerHTML = message;
        }

        function updateHealthBars() {
            const playerHealthBar = document.getElementById('playerHealthBar');
            const monsterHealthBar = document.getElementById('monsterHealthBar');

            playerHealthBar.style.width = `${playerHealth}%`;
            monsterHealthBar.style.width = `${(monsterHealth / (enemies.find(e => e.name === monsterName)?.health || 1)) * 100}%`;
        }

        function describeRoom() {
            visitedRooms.add(currentRoom); // Mark the room as visited
            const room = rooms[currentRoom];
            let description = room.description + "<br>";
            description += "You can go to: " + room.exits.join(", ") + ".<br>";
            if (currentRoom === 24) {
                description += "Prepare for the final battle!";
            } else if (currentRoom === 23 && !keyFound) {
                description += "The door is locked. You need a key to enter.";
            }
            updateOutput(description);
            updateHealthBars();
        }

        function addItemToInventory(item) {
            inventory.push(item);
            if (item === "small key") keyFound = true; // Mark key as found
            updateOutput(`You added "${item}" to your inventory.`);
        }

        document.getElementById('moveBtn').addEventListener('click', () => {
            const room = rooms[currentRoom];
            const direction = parseInt(prompt("Which room do you want to enter? (" + room.exits.join(", ") + ")"));
            if (room.exits.includes(direction)) {
                if (direction === 24 && visitedRooms.size < Object.keys(rooms).length - 1) { // Check if all rooms except boss room are visited
                    updateOutput("You need to explore all rooms before confronting the Dark Overlord!");
                } else if (direction === 23 && !keyFound) {
                    updateOutput("The door is locked. You need a key to enter.");
                } else {
                    currentRoom = direction;
                    describeRoom();
                    if (room.interaction) {
                        handleInteraction(room.interaction);
                    }
                    if (direction === 3 || direction === 5) { // Combat rooms
                        startFight();
                    }
                    if (currentRoom === 24) { // Final boss room
                        startFinalBossFight();
                    }
                }
            } else {
                updateOutput("You can't go that way.");
            }
        });

        function handleInteraction(interactionPrompt) {
            const response = prompt(interactionPrompt);
            if (response.toLowerCase() === 'yes') {
                switch (currentRoom) {
                    case 3: 
                        updateOutput("You fight the lurking monster!"); 
                        startFight(); 
                        break;
                    case 5: 
                        addItemToInventory("rusty sword");
                        break;
                    case 6: 
                        addItemToInventory("hidden spell");
                        break;
                    default: 
                        updateOutput("You found nothing interesting.");
                }
            } else {
                updateOutput("You decided to ignore it.");
            }
        }

        function startFight() {
            const enemy = enemies[Math.floor(Math.random() * enemies.length)];
            monsterName = enemy.name;
            monsterHealth = enemy.health;
            updateOutput(`A wild ${monsterName} appears! It has ${monsterHealth} health!`);
            inCombat = true;
            monsterCombatLoop(enemy);
        }

        function monsterCombatLoop(enemy) {
            while (inCombat && playerHealth > 0 && monsterHealth > 0) {
                const action = prompt("Choose your action: (attack/dodge)");
                if (action === "attack") {
                    const damage = Math.floor(Math.random() * 15) + 5; // Damage range for player
                    monsterHealth -= damage;
                    updateOutput(`You hit the ${monsterName} for ${damage} damage! It has ${monsterHealth} health left.`);
                } else if (action === "dodge") {
                    dodge();
                }
                if (monsterHealth > 0) {
                    const monsterDamage = Math.floor(Math.random() * (enemy.maxDamage - enemy.minDamage + 1)) + enemy.minDamage;
                    playerHealth -= monsterDamage;
                    updateOutput(`The ${monsterName} attacks you for ${monsterDamage} damage! You have ${playerHealth} health left.`);
                }
                updateHealthBars();
                if (playerHealth <= 0) {
                    updateOutput("You have been defeated!");
                    inCombat = false;
                } else if (monsterHealth <= 0) {
                    updateOutput(`You defeated the ${monsterName}!`);
                    inCombat = false;
                }
            }
        }

        function startFinalBossFight() {
            inCombat = true;
            const boss = { name: "Dark Overlord", health: 100, minDamage: 10, maxDamage: 20 };
            monsterName = boss.name;
            monsterHealth = boss.health;
            updateOutput(`A wild ${monsterName} appears! It has ${monsterHealth} health!`);
            updateHealthBars();
            finalBossCombatLoop(boss);
        }

        function finalBossCombatLoop(boss) {
            while (inCombat && playerHealth > 0 && monsterHealth > 0) {
                const action = prompt("Choose your action: (attack/dodge/special attack)");
                if (action === "attack") {
                    const damage = Math.floor(Math.random() * 15) + 10; // Increased damage range for balance
                    monsterHealth -= damage;
                    updateOutput(`You hit the ${monsterName} for ${damage} damage! It has ${monsterHealth} health left.`);
                } else if (action === "dodge") {
                    dodge();
                } else if (action === "special attack") {
                    if (Math.random() < 0.5) {
                        const specialDamage = Math.floor(Math.random() * 30) + 10; // Stronger special attack
                        monsterHealth -= specialDamage;
                        updateOutput(`You unleash a powerful attack on the ${monsterName} for ${specialDamage} damage!`);
                    } else {
                        updateOutput("Your special attack failed!");
                    }
                }
                if (monsterHealth > 0) {
                    const monsterDamage = Math.floor(Math.random() * (boss.maxDamage - boss.minDamage + 1)) + boss.minDamage;
                    playerHealth -= monsterDamage;
                    updateOutput(`The ${monsterName} attacks you for ${monsterDamage} damage! You have ${playerHealth} health left.`);
                }
                
                updateHealthBars();
                
                if (playerHealth <= 0) {
                    updateOutput("You have been defeated by the Dark Overlord!");
                    inCombat = false;
                } else if (monsterHealth <= 0) {
                    updateOutput(`You defeated the ${monsterName}! The dungeon is safe once more!`);
                    inCombat = false;
                    // Optionally: end game or give rewards
                }
            }
        }

        document.getElementById('searchBtn').addEventListener('click', () => {
            if (currentRoom in searchResponses) {
                const itemFound = searchResponses[currentRoom];
                addItemToInventory(itemFound.item);
                updateOutput(itemFound.message);
            } else {
                updateOutput("You found nothing.");
            }
        });

        document.getElementById('inventoryBtn').addEventListener('click', () => {
            updateOutput(`Your inventory: ${inventory.join(", ") || "empty"}`);
        });

        document.getElementById('useItemBtn').addEventListener('click', () => {
            const item = prompt("Which item do you want to use? (" + inventory.join(", ") + ")");
            if (inventory.includes(item)) {
                const usableItem = usableItems[item];
                if (usableItem) {
                    if (usableItem.type === "heal") {
                        playerHealth += usableItem.value;
                        playerHealth = Math.min(playerHealth, 100); // Max health cap
                        updateOutput(`You used ${item} and healed for ${usableItem.value} health! You now have ${playerHealth} health.`);
                    } else if (usableItem.type === "damage") {
                        // If it's a damage item, you could implement it in combat if you want
                        updateOutput(`You used ${item} for a powerful attack!`);
                    } else if (usableItem.type === "unlock") {
                        // Logic for unlocking a door could go here
                    }
                    inventory.splice(inventory.indexOf(item), 1); // Remove used item
                } else {
                    updateOutput("You can't use that item.");
                }
            } else {
                updateOutput("You don't have that item in your inventory.");
            }
        });

        describeRoom(); // Start the game by describing the initial room
    </script>
</body>
</html>


